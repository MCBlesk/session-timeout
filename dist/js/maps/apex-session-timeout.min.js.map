{"version":3,"sources":["apex-session-timeout.js"],"names":["$","plugin","widget","options","timeoutAction","timeoutMessage","timeoutURL","logoutURL","showWarning","showWarningMiliBefore","showWarningTitle","showWarningMessage","hideHistory","sessionIdleDuration","maskBrowser","ajaxIdentifier","keepSessionAlive","debug","_create","apex","this","name","_createPrivateStorage","_startTimers","_startIdleMonitor","_startPingTimer","uiw","_values","pingID","setTimeout","_handlePing","pingFrequency","idleTimer","checkIdleFrequency","document","bind","_pingSession","docTitle","title","titleBlinkIntervalID","titleBlinkInterval","warningID","timeoutID","isWarned","timeoutActionEnum","ALERT","REDIRECT","LOGOUT","_elements","$dialog","_warn","_handleExpiredSession","_stopTimers","clearTimeout","_showMask","_expireAction","alert","_redirect","dialogHtml","append","dialog","disabled","autoOpen","buttons","Ok","closeOnEscape","closeText","dialogClass","draggable","height","hide","maxhHeight","maxWidth","minHeight","minWidth","modal","resizable","show","stack","close","_closeWarning","_startTitleBlink","remove","_stopBlink","_titleBlink","setInterval","clearInterval","url","window","location","replace","href","maskHeight","maskWidth","width","$mask","createElement","attr","css","resize","data","dateType","success","jQuery","server"],"mappings":"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","file":"../apex-session-timeout.min.js","sourcesContent":["(function($, plugin){\r\n   \"use strict\";\r\n   $.widget('apex.apex_session_timeout', {\r\n      options:{\r\n         timeoutAction: null,\r\n         timeoutMessage: null,\r\n         timeoutURL: null,\r\n         logoutURL: null,\r\n         showWarning: null,\r\n         showWarningMiliBefore: null,\r\n         showWarningTitle: null,\r\n         showWarningMessage: null,\r\n         hideHistory:false,\r\n         sessionIdleDuration: null,\r\n         maskBrowser: null,\r\n         ajaxIdentifier: null,\r\n         keepSessionAlive : null,\r\n         debug: true //$('#pdebug').length !== 0 //true boolean for ===\r\n      },\r\n      _create: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _create (start)');\r\n\r\n         apex.debug('...Options');\r\n         if (uiw.options.debug){\r\n            for (name in uiw.options) {\r\n               apex.debug('......' + name + ': \"' + uiw.options[name] + '\"');\r\n            }\r\n         }\r\n         \r\n         uiw._createPrivateStorage();\r\n         \r\n         uiw._startTimers();\r\n         \r\n         if(uiw.options.keepSessionAlive){\r\n            uiw._startIdleMonitor();\r\n            uiw._startPingTimer();\r\n         }\r\n\r\n         apex.debug('Session Timeout: _create (end)');\r\n      },\r\n      _startPingTimer: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _startSessionPingTimer (start)');\r\n   \t\t\r\n         uiw._values.pingID = setTimeout(function(){ \r\n            uiw._handlePing(); \r\n         }, uiw._values.pingFrequency);\r\n   \t\t\r\n         apex.debug('Session Timeout: _startSessionPingTimer (end)');\r\n      },\r\n      _startIdleMonitor: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _startIdleMonitor (start)');\r\n\r\n         $.idleTimer(uiw._values.checkIdleFrequency);\r\n\r\n         $(document).bind(\"idle.idleTimer\", function(){\r\n            apex.debug('Session Timeout: session inactive!');\r\n         });\r\n         \r\n         $(document).bind(\"active.idleTimer\", function(){\r\n             apex.debug('Session Timeout: session active!)');\r\n             uiw._pingSession();\r\n         });\t\r\n         \r\n         apex.debug('Session Timeout: _startIdleMonitor (end)');\t\r\n      },\r\n      _createPrivateStorage: function() {\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _createPrivateStorage (start)');\r\n   \t\t\r\n         uiw._values = {\r\n            docTitle : document.title,\r\n            titleBlinkIntervalID: null,\r\n            titleBlinkInterval: 8000,\r\n            warningID: null,\r\n            timeoutID: null,\r\n            pingID: null,\r\n            checkIdleFrequency: 60000,\r\n            pingFrequency: 60000,\r\n            isWarned:false,\r\n            timeoutActionEnum : {\r\n               ALERT : 'ALERT',\r\n               REDIRECT : 'REDIRECT',\r\n               LOGOUT : 'LOGOUT'\r\n            }\r\n         };\r\n         \r\n         uiw._elements = {\r\n            $dialog: {}\r\n         };\r\n         \r\n         apex.debug('Session Timeout: _createPrivateStorage (end)');\r\n      },\r\n      _startTimers: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: startTimer (start)');\r\n         \r\n         if (uiw.options.showWarning){\r\n            uiw._values.warningID = setTimeout(function(){\r\n               uiw._warn();\r\n            }, uiw.options.sessionIdleDuration - uiw.options.showWarningMiliBefore);\r\n            apex.debug('...initializing warning timeout('+ uiw._values.warningID +')');\r\n         }\r\n         \r\n         uiw._values.timeoutID = setTimeout(function(){ uiw._handleExpiredSession(); },uiw.options.sessionIdleDuration);\r\n         apex.debug('...initializing idle timeout('+ uiw._values.timeoutID +')');\r\n   \t\t\r\n         apex.debug('Session Timeout: startTimer (end)');\r\n      },\r\n      _stopTimers: function(){\r\n         var uiw = this;\r\n   \t\r\n         apex.debug('Session Timeout: _stopTimers (start)');\r\n         \r\n         if(uiw.options.keepSessionAlive && uiw._values.timeoutID && uiw._values.timeoutID !== null){\r\n         apex.debug('...clearng idle timeout('+ uiw._values.timeoutID +')');\r\n            clearTimeout(uiw._values.timeoutID);\r\n            uiw._values.timeoutID = null;\r\n         }\r\n         \r\n         if (uiw.options.showWarning && uiw._values.warningID && uiw._values.warningID !== null){\r\n            apex.debug('...clearng warning timeout('+ uiw._values.warningID +')');\r\n            clearTimeout(uiw._values.warningID);\r\n            uiw._values.warningID = null;\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _stopTimers (end)');\r\n      },\r\n      _handleExpiredSession: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _handleExpiredSession (start)');\r\n\r\n         if(uiw.options.maskBrowser){\r\n            uiw._showMask();\r\n         }\r\n         \r\n         setTimeout(function(){ \r\n            uiw._expireAction();\r\n         }, 100);      \r\n         \r\n         apex.debug('Session Timeout: _handleExpiredSession (end)');\r\n      },\r\n      _expireAction: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _expireAction (start)');\r\n\r\n         if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.ALERT) {\r\n            alert(uiw.options.timeoutMessage);\r\n            uiw._redirect(uiw.options.timeoutURL);\r\n         } else if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.REDIRECT) {\r\n            uiw._redirect(uiw.options.timeoutURL);\r\n         } else if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.LOGOUT) {\r\n            uiw._redirect(uiw.options.logoutURL);\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _expireAction (end)');\r\n      },\r\n      _warn: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _warn (start)');\r\n   \t\t\r\n         var dialogHtml = \r\n            '<div class=\"session-timeout-container ui-widget\">' + \r\n            '   <p>'+ uiw.options.showWarningMessage  +'</p>' + \r\n            '</div>';\t\t\r\n   \t\t\t\r\n         $('body').append( dialogHtml );\r\n         uiw._elements.$dialog = $('.session-timeout-container'); \r\n         \r\n         uiw._elements.$dialog.dialog({\r\n            disabled: false,\r\n            autoOpen: true,\r\n            buttons: { \"Ok\": function() { $(this).dialog(\"close\"); } },\r\n            closeOnEscape: true,\r\n            closeText: 'Close',\r\n            dialogClass: 'session-timeout-dialog',\r\n            draggable: true,\r\n            height: 'auto',\r\n            hide: null,\r\n            maxhHeight: false,\r\n            maxWidth: false,\r\n            minHeight: 100,\r\n            minWidth: 200,\r\n            modal: true,\r\n            resizable: false,\r\n            show: null,\r\n            stack: true,\r\n            title: uiw.options.showWarningTitle,\r\n            close: function() {\r\n               uiw._closeWarning();\r\n            }\r\n         });\r\n\r\n         uiw._startTitleBlink();\r\n         uiw._values.isWarned = true;\r\n         \r\n         if(uiw.options.keepSessionAlive){\r\n            $.idleTimer('destroy');\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _warn (end)');\r\n      },\r\n      _closeWarning: function(){\r\n         var uiw = this;\r\n   \t\t\r\n         apex.debug('Session Timeout: _closeWarning (start)');\r\n         \r\n         uiw._elements.$dialog.dialog('destroy');\r\n         uiw._elements.$dialog.remove();\r\n         uiw._stopBlink();\r\n         uiw._stopTimers();\r\n         uiw._values.isWarned = false;\r\n   \t\t\r\n         if(uiw.options.keepSessionAlive){\r\n            uiw._pingSession();\r\n            uiw._startIdleMonitor();\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _closeWarning (end)');\r\n      },\r\n      _startTitleBlink: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _startTitleBlink (start)');\r\n\r\n         uiw._titleBlink();\r\n         uiw._values.titleBlinkIntervalID = setInterval(function(){ \r\n            uiw._titleBlink(); \r\n         }, uiw._values.titleBlinkInterval);\r\n         \r\n         apex.debug('Session Timeout: _startTitleBlink (end)');\r\n      },\r\n      _titleBlink: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _titleBlink (start)');   \r\n      \r\n         document.title = uiw.options.showWarningTitle;\r\n         setTimeout(function(){ \r\n            document.title = uiw._values.docTitle;  \r\n         }, 500);\r\n          \r\n         apex.debug('Session Timeout: _titleBlink (end)');\r\n      },\r\n      _stopBlink: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _stopBlink (start)');\r\n         \r\n         document.title = uiw._values.docTitle;\r\n         clearInterval(uiw._values.titleBlinkIntervalID);\r\n\r\n         apex.debug('Session Timeout: _stopBlink (end)');\r\n      },\r\n      _redirect: function(url){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _redirect (start)');\r\n         \r\n         if (uiw.options.hideHistory) {\r\n            window.location.replace(url);\r\n         } else {\r\n            window.location.href = url;\r\n         }  \r\n         \r\n         apex.debug('Session Timeout: _redirect (end)');\r\n      },\r\n      _showMask: function(){\r\n         var uiw = this;\r\n         var maskHeight = $(document).height();\r\n         var maskWidth = $(window).width();\r\n         var $mask = $(document.createElement('div')).attr('id','session-timeout-mask').css({\r\n            'width' : maskWidth,\r\n            'height' : maskHeight\r\n         });\r\n\r\n         apex.debug('Session Timeout: _showMask (start)');\r\n         apex.debug('...maskHeight:' + maskHeight);\r\n         apex.debug('...maskWidth:' + maskWidth);\r\n\r\n         $('body').append($mask);\r\n\r\n         $(window).resize(function(){ \r\n            var maskHeight = $(document).height();\r\n            var maskWidth = $(window).width();\r\n\r\n            $('#session-timeout-mask').css({'width':maskWidth,'height':maskHeight});\r\n         });\r\n         \r\n         apex.debug('Session Timeout: _showMask (end)');\r\n      },\r\n      _handlePing: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _handlePing (start)');   \r\n         \r\n         if($.data(document,'idleTimer') === 'active'){\r\n            apex.debug('session is active. Refreshing server session');\r\n            uiw._pingSession();\r\n         }else{\r\n            apex.debug('session is inactive. Do not refresh server session.');\r\n         }\r\n         apex.debug('Session Timeout: _handlePing (end)');         \r\n      },\r\n      _pingSession: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _pingSession (start)');\r\n         \r\n         plugin(\r\n            uiw.options.ajaxIdentifier,\r\n            {},\r\n            {\r\n               dateType: 'text',\r\n               success: function(data){\r\n                  apex.debug('Ajax request successful');\r\n                  clearTimeout(uiw._values.pingID);\r\n                  uiw._startPingTimer();\r\n                  uiw._stopTimers();\r\n                  uiw._startTimers();\r\n               }\r\n            }\r\n         ); \r\n         \r\n         apex.debug('Session Timeout: _pingSession (end)');\r\n      }\r\n   });\r\n})( apex.jQuery, apex.server.plugin );"]}