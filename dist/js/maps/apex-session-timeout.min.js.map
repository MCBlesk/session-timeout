{"version":3,"sources":["apex-session-timeout.js"],"names":["$","plugin","widget","options","timeoutAction","timeoutMessage","timeoutURL","logoutURL","showWarning","showWarningMiliBefore","showWarningTitle","showWarningMessage","hideHistory","sessionIdleDuration","maskBrowser","ajaxIdentifier","keepSessionAlive","debug","_create","uiw","this","apex","name","_createPrivateStorage","_startTimers","_startIdleMonitor","_startPingTimer","_values","pingID","setTimeout","_handlePing","pingFrequency","idleTimer","checkIdleFrequency","document","bind","_pingSession","docTitle","title","titleBlinkIntervalID","titleBlinkInterval","warningID","timeoutID","isWarned","timeoutActionEnum","ALERT","REDIRECT","LOGOUT","_elements","$dialog","_warn","_handleExpiredSession","_stopTimers","clearTimeout","_showMask","_expireAction","alert","_redirect","dialogHtml","append","dialog","disabled","autoOpen","buttons","Ok","closeOnEscape","closeText","dialogClass","draggable","height","hide","maxhHeight","maxWidth","minHeight","minWidth","modal","resizable","show","stack","close","_closeWarning","_startTitleBlink","remove","_stopBlink","_titleBlink","setInterval","clearInterval","url","window","location","replace","href","maskHeight","maskWidth","width","$mask","createElement","attr","css","resize","data","dataType","success","jQuery","server"],"mappings":"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","file":"../apex-session-timeout.min.js","sourcesContent":["(function($, plugin){\r\n   \"use strict\";\r\n   $.widget('apex.apex_session_timeout', {\r\n      options:{\r\n         timeoutAction: null,\r\n         timeoutMessage: null,\r\n         timeoutURL: null,\r\n         logoutURL: null,\r\n         showWarning: null,\r\n         showWarningMiliBefore: null,\r\n         showWarningTitle: null,\r\n         showWarningMessage: null,\r\n         hideHistory:false,\r\n         sessionIdleDuration: null,\r\n         maskBrowser: null,\r\n         ajaxIdentifier: null,\r\n         keepSessionAlive : null,\r\n         debug: true //$('#pdebug').length !== 0 //true boolean for ===\r\n      },\r\n      _create: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _create (start)');\r\n\r\n         apex.debug('...Options');\r\n         if (uiw.options.debug){\r\n            for (name in uiw.options) {\r\n               apex.debug('......' + name + ': \"' + uiw.options[name] + '\"');\r\n            }\r\n         }\r\n         \r\n         uiw._createPrivateStorage();\r\n         \r\n         uiw._startTimers();\r\n         \r\n         if(uiw.options.keepSessionAlive){\r\n            uiw._startIdleMonitor();\r\n            uiw._startPingTimer();\r\n         }\r\n\r\n         apex.debug('Session Timeout: _create (end)');\r\n      },\r\n      _startPingTimer: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _startSessionPingTimer (start)');\r\n   \t\t\r\n         uiw._values.pingID = setTimeout(function(){ \r\n            uiw._handlePing(); \r\n         }, uiw._values.pingFrequency);\r\n   \t\t\r\n         apex.debug('Session Timeout: _startSessionPingTimer (end)');\r\n      },\r\n      _startIdleMonitor: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _startIdleMonitor (start)');\r\n\r\n         $.idleTimer(uiw._values.checkIdleFrequency);\r\n\r\n         $(document).bind(\"idle.idleTimer\", function(){\r\n            apex.debug('Session Timeout: session inactive!');\r\n         });\r\n         \r\n         $(document).bind(\"active.idleTimer\", function(){\r\n             apex.debug('Session Timeout: session active!)');\r\n             uiw._pingSession();\r\n         });\t\r\n         \r\n         apex.debug('Session Timeout: _startIdleMonitor (end)');\t\r\n      },\r\n      _createPrivateStorage: function() {\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _createPrivateStorage (start)');\r\n   \t\t\r\n         uiw._values = {\r\n            docTitle : document.title,\r\n            titleBlinkIntervalID: null,\r\n            titleBlinkInterval: 8000,\r\n            warningID: null,\r\n            timeoutID: null,\r\n            pingID: null,\r\n            checkIdleFrequency: 60000,\r\n            pingFrequency: 60000,\r\n            isWarned:false,\r\n            timeoutActionEnum : {\r\n               ALERT : 'ALERT',\r\n               REDIRECT : 'REDIRECT',\r\n               LOGOUT : 'LOGOUT'\r\n            }\r\n         };\r\n         \r\n         uiw._elements = {\r\n            $dialog: {}\r\n         };\r\n         \r\n         apex.debug('Session Timeout: _createPrivateStorage (end)');\r\n      },\r\n      _startTimers: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: startTimer (start)');\r\n         \r\n         if (uiw.options.showWarning){\r\n            uiw._values.warningID = setTimeout(function(){\r\n               uiw._warn();\r\n            }, uiw.options.sessionIdleDuration - uiw.options.showWarningMiliBefore);\r\n            apex.debug('...initializing warning timeout('+ uiw._values.warningID +')');\r\n         }\r\n         \r\n         uiw._values.timeoutID = setTimeout(function(){ uiw._handleExpiredSession(); },uiw.options.sessionIdleDuration);\r\n         apex.debug('...initializing idle timeout('+ uiw._values.timeoutID +')');\r\n   \t\t\r\n         apex.debug('Session Timeout: startTimer (end)');\r\n      },\r\n      _stopTimers: function(){\r\n         var uiw = this;\r\n   \t\r\n         apex.debug('Session Timeout: _stopTimers (start)');\r\n         \r\n         if(uiw.options.keepSessionAlive && uiw._values.timeoutID && uiw._values.timeoutID !== null){\r\n         apex.debug('...clearng idle timeout('+ uiw._values.timeoutID +')');\r\n            clearTimeout(uiw._values.timeoutID);\r\n            uiw._values.timeoutID = null;\r\n         }\r\n         \r\n         if (uiw.options.showWarning && uiw._values.warningID && uiw._values.warningID !== null){\r\n            apex.debug('...clearng warning timeout('+ uiw._values.warningID +')');\r\n            clearTimeout(uiw._values.warningID);\r\n            uiw._values.warningID = null;\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _stopTimers (end)');\r\n      },\r\n      _handleExpiredSession: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _handleExpiredSession (start)');\r\n\r\n         if(uiw.options.maskBrowser){\r\n            uiw._showMask();\r\n         }\r\n         \r\n         setTimeout(function(){ \r\n            uiw._expireAction();\r\n         }, 100);      \r\n         \r\n         apex.debug('Session Timeout: _handleExpiredSession (end)');\r\n      },\r\n      _expireAction: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _expireAction (start)');\r\n\r\n         if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.ALERT) {\r\n            alert(uiw.options.timeoutMessage);\r\n            uiw._redirect(uiw.options.timeoutURL);\r\n         } else if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.REDIRECT) {\r\n            uiw._redirect(uiw.options.timeoutURL);\r\n         } else if (uiw.options.timeoutAction === uiw._values.timeoutActionEnum.LOGOUT) {\r\n            uiw._redirect(uiw.options.logoutURL);\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _expireAction (end)');\r\n      },\r\n      _warn: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _warn (start)');\r\n   \t\t\r\n         var dialogHtml = \r\n            '<div class=\"session-timeout-container ui-widget\">' + \r\n            '   <p>'+ uiw.options.showWarningMessage  +'</p>' + \r\n            '</div>';\t\t\r\n   \t\t\t\r\n         $('body').append( dialogHtml );\r\n         uiw._elements.$dialog = $('.session-timeout-container'); \r\n         \r\n         uiw._elements.$dialog.dialog({\r\n            disabled: false,\r\n            autoOpen: true,\r\n            buttons: { \"Ok\": function() { $(this).dialog(\"close\"); } },\r\n            closeOnEscape: true,\r\n            closeText: 'Close',\r\n            dialogClass: 'session-timeout-dialog',\r\n            draggable: true,\r\n            height: 'auto',\r\n            hide: null,\r\n            maxhHeight: false,\r\n            maxWidth: false,\r\n            minHeight: 100,\r\n            minWidth: 200,\r\n            modal: true,\r\n            resizable: false,\r\n            show: null,\r\n            stack: true,\r\n            title: uiw.options.showWarningTitle,\r\n            close: function() {\r\n               uiw._closeWarning();\r\n            }\r\n         });\r\n\r\n         uiw._startTitleBlink();\r\n         uiw._values.isWarned = true;\r\n         \r\n         if(uiw.options.keepSessionAlive){\r\n            $.idleTimer('destroy');\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _warn (end)');\r\n      },\r\n      _closeWarning: function(){\r\n         var uiw = this;\r\n   \t\t\r\n         apex.debug('Session Timeout: _closeWarning (start)');\r\n         \r\n         uiw._elements.$dialog.dialog('destroy');\r\n         uiw._elements.$dialog.remove();\r\n         uiw._stopBlink();\r\n         uiw._stopTimers();\r\n         uiw._values.isWarned = false;\r\n   \t\t\r\n         if(uiw.options.keepSessionAlive){\r\n            uiw._pingSession();\r\n            uiw._startIdleMonitor();\r\n         }\r\n         \r\n         apex.debug('Session Timeout: _closeWarning (end)');\r\n      },\r\n      _startTitleBlink: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _startTitleBlink (start)');\r\n\r\n         uiw._titleBlink();\r\n         uiw._values.titleBlinkIntervalID = setInterval(function(){ \r\n            uiw._titleBlink(); \r\n         }, uiw._values.titleBlinkInterval);\r\n         \r\n         apex.debug('Session Timeout: _startTitleBlink (end)');\r\n      },\r\n      _titleBlink: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _titleBlink (start)');   \r\n      \r\n         document.title = uiw.options.showWarningTitle;\r\n         setTimeout(function(){ \r\n            document.title = uiw._values.docTitle;  \r\n         }, 500);\r\n          \r\n         apex.debug('Session Timeout: _titleBlink (end)');\r\n      },\r\n      _stopBlink: function(){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _stopBlink (start)');\r\n         \r\n         document.title = uiw._values.docTitle;\r\n         clearInterval(uiw._values.titleBlinkIntervalID);\r\n\r\n         apex.debug('Session Timeout: _stopBlink (end)');\r\n      },\r\n      _redirect: function(url){\r\n         var uiw = this;\r\n         \r\n         apex.debug('Session Timeout: _redirect (start)');\r\n         \r\n         if (uiw.options.hideHistory) {\r\n            window.location.replace(url);\r\n         } else {\r\n            window.location.href = url;\r\n         }  \r\n         \r\n         apex.debug('Session Timeout: _redirect (end)');\r\n      },\r\n      _showMask: function(){\r\n         var uiw = this;\r\n         var maskHeight = $(document).height();\r\n         var maskWidth = $(window).width();\r\n         var $mask = $(document.createElement('div')).attr('id','session-timeout-mask').css({\r\n            'width' : maskWidth,\r\n            'height' : maskHeight\r\n         });\r\n\r\n         apex.debug('Session Timeout: _showMask (start)');\r\n         apex.debug('...maskHeight:' + maskHeight);\r\n         apex.debug('...maskWidth:' + maskWidth);\r\n\r\n         $('body').append($mask);\r\n\r\n         $(window).resize(function(){ \r\n            var maskHeight = $(document).height();\r\n            var maskWidth = $(window).width();\r\n\r\n            $('#session-timeout-mask').css({'width':maskWidth,'height':maskHeight});\r\n         });\r\n         \r\n         apex.debug('Session Timeout: _showMask (end)');\r\n      },\r\n      _handlePing: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _handlePing (start)');   \r\n         \r\n         if($.data(document,'idleTimer') === 'active'){\r\n            apex.debug('session is active. Refreshing server session');\r\n            uiw._pingSession();\r\n         }else{\r\n            apex.debug('session is inactive. Do not refresh server session.');\r\n         }\r\n         apex.debug('Session Timeout: _handlePing (end)');         \r\n      },\r\n      _pingSession: function(){\r\n         var uiw = this;\r\n\r\n         apex.debug('Session Timeout: _pingSession (start)');\r\n         \r\n         plugin(\r\n            uiw.options.ajaxIdentifier,\r\n            {},\r\n            {\r\n               dataType: 'text',\r\n               success: function(data){\r\n                  apex.debug('Ajax request successful');\r\n                  clearTimeout(uiw._values.pingID);\r\n                  uiw._startPingTimer();\r\n                  uiw._stopTimers();\r\n                  uiw._startTimers();\r\n               }\r\n            }\r\n         ); \r\n         \r\n         apex.debug('Session Timeout: _pingSession (end)');\r\n      }\r\n   });\r\n})( apex.jQuery, apex.server.plugin );"]}